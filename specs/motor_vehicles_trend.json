{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Stacked area chart of registered vehicles by category with optional normalization.",
  "width": "container",
  "height": 360,
  "data": {
    "url": "data/motor_vehicles_trend.json"
  },
  "params": [
    {
      "name": "NormalizeShare",
      "value": false,
      "bind": {
        "input": "checkbox",
        "name": "Show as share (%) "
      }
    }
  ],
  "transform": [
    {
      "calculate": "toNumber(datum.year)",
      "as": "year_num"
    },
    {
      "joinaggregate": [
        {
          "op": "sum",
          "field": "count",
          "as": "year_total"
        }
      ],
      "groupby": [
        "year_num"
      ]
    },
    {
      "calculate": "datum.year_total === 0 ? 0 : datum.count / datum.year_total",
      "as": "share"
    },
    {
      "calculate": "NormalizeShare ? datum.share * 100 : datum.count",
      "as": "display_value"
    },
    {
      "calculate": "NormalizeShare ? 'Share of registrations (%)' : 'Registered vehicles'",
      "as": "y_title"
    }
  ],
  "mark": {
    "type": "area",
    "interpolate": "monotone"
  },
  "encoding": {
    "x": {
      "field": "year_num",
      "type": "quantitative",
      "title": "Year",
      "axis": {
        "tickCount": 6,
        "format": "d"
      }
    },
    "y": {
      "field": "display_value",
      "type": "quantitative",
      "stack": "zero",
      "title": {"field": "y_title"}
    },
    "color": {
      "field": "vehicle_type",
      "title": "Vehicle category"
    },
    "tooltip": [
      {
        "field": "year_num",
        "type": "quantitative",
        "title": "Year"
      },
      {
        "field": "vehicle_type",
        "title": "Vehicle category"
      },
      {
        "field": "count",
        "type": "quantitative",
        "format": ",",
        "title": "Registrations"
      },
      {
        "field": "share",
        "type": "quantitative",
        "format": ".1%",
        "title": "Share"
      }
    ]
  },
  "config": {
    "view": {
      "stroke": null
    },
    "legend": {
      "orient": "bottom",
      "columns": 3
    }
  }
}
